<!DOCTYPE html>
<!-- Copyright (C) 2011-2012 Frogtoss Games, Inc.  See glmike.js for license. -->
<HTML>
  <HEAD>
    <TITLE>glMikeFirst</TITLE>
    <META http-equiv="content-type" content="text-html; charset=ISO-8859-1">

    <SCRIPT type="text/javascript" src="lib/gl-Matrix.js"></SCRIPT>
    <SCRIPT type="text/javascript" src="lib/webgl-utils.js"></SCRIPT>
    <SCRIPT type="text/javascript" src="lib/ftgplane.js"></SCRIPT>
    <SCRIPt type="text/javascript" src="lib/webgl-debug.js"></SCRIPT>
    <SCRIPT src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></SCRIPT>
    <SCRIPT src="glmike.js" type="text/javascript"></SCRIPT>

    <!-- Post shading -->
    <SCRIPT id="vpost" type="x-shader/x-vertex">
                   // Common vertex post process shader -- perfect for drawTextureToViewport
                   attribute vec3 aVertexPosition;
                   attribute vec2 aTextureCoord;

                   uniform vec2 uTextureSize;

                   uniform mat4 uMVMatrix;
                   uniform mat4 uPMatrix;
                   varying vec2 vTextureCoord;
                   
                   void main( void ) {
                       gl_Position = uPMatrix * uMVMatrix * vec4( aVertexPosition, 1 );
                       vTextureCoord = aTextureCoord;
                   }
    </SCRIPT>

    <SCRIPT id="fpost" type="x-shader/x-fragment">
                   precision mediump float;
                   varying vec2 vTextureCoord;
                   uniform sampler2D uSampler;

                   void main( void ) {
                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );
                       
                       gl_FragColor = col;
                   }
    </SCRIPT>


    <SCRIPT id="fpostGrayscale" type="x-shader/x-fragment">
                   precision mediump float;
                   varying vec2 vTextureCoord;
                   uniform sampler2D uSampler;
                   uniform float grayness; /* 0 to 1 */

                   void main( void ) {
                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );

                       vec3 gray = mix( col.rgb, vec3( dot( col.rgb, vec3( 0.3, 0.59, 0.11 ) ) ), grayness );
                       //vec3 gray = mix( col.rgb, vec3( dot( col.rgb, vec3( 0.3, 0.59, 0.11 ) ) ), 0.8 );
                       
                       gl_FragColor = vec4( gray, col.a );
                   }
    </SCRIPT>


    <SCRIPT id="fpostblur" type="x-shader/x-fragment">
                   precision mediump float;
                   varying vec2 vTextureCoord;
                   uniform sampler2D uSampler;
                   uniform vec2 uTextureSize;

                   uniform float radius;


                   void main( void ) {
                       float oh = radius / uTextureSize[0];
                       float ov = radius / uTextureSize[1];

                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );
                       vec4 col2 = texture2D( uSampler, vec2( vTextureCoord.s+oh, vTextureCoord.t+ov ) );

                       vec4 sum = vec4(0,0,0,0);
                       sum += texture2D( uSampler, vec2( vTextureCoord.s-oh, vTextureCoord.t-ov ) )*0.0625;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s   , vTextureCoord.t-ov ) )*0.125;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s+oh, vTextureCoord.t-ov ) )*0.0625;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s-oh, vTextureCoord.t    ) )*0.125;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s   , vTextureCoord.t    ) )*0.25;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s+oh, vTextureCoord.t    ) )*0.125;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s-oh, vTextureCoord.t+ov ) )*0.0625;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s   , vTextureCoord.t+ov ) )*0.125;
                       sum += texture2D( uSampler, vec2( vTextureCoord.s+oh, vTextureCoord.t+ov ) )*0.0625;


                       //gl_FragColor = texture2D( uSampler, vec2( 0.1,0.1 ) );
                       gl_FragColor = sum;
                       //gl_FragColor = vec4(col.rgb, col2.a);
                   }
    </SCRIPT>

    <!-- Forward shading -->
    <SCRIPT id="vdef" type="x-shader/x-vertex">
                   // A copy of the def vshader from the js source.
                   attribute vec3 aVertexPosition;
                   attribute vec2 aTextureCoord;

                   uniform mat4 uMVMatrix;
                   uniform mat4 uPMatrix;
                   uniform mat4 uBoxMatrix;

                   varying vec2 vTextureCoord;

                   void main( void ) {
                       gl_Position = uPMatrix * uMVMatrix * uBoxMatrix * vec4(aVertexPosition, 1 );
                       vTextureCoord = aTextureCoord;
                   }
    </SCRIPT>

    <SCRIPT id="fshadowstamp" type="x-shader/x-fragment">
                   precision mediump float;
                   varying vec2 vTextureCoord;
                   uniform sampler2D uSampler;

                   void main( void ) {
                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );

                       gl_FragColor = vec4( 0.0, 0.0, 0.0, col.a );
                   }
    </SCRIPT>


    
  </HEAD>

  <BODY onLoad="webGLStart()" style="width: 100%, height: 100%, body: 100%; background-color:#000;">

      <div style="float:left;">
    <CANVAS id="maincanvas" style="border: none;" width="300" height="300"></CANVAS>
    <p>The actual rendered scene</p>
</div>
<div style="margin-left:30px; float:left;"><img src="alphatest_ref.png"/><p>reference image from photoshop</p></div>
    <div style="clear:both;"/>
    <P>Michael Labbe's plane demo</A>.
    
  </BODY>

  
</HTML>
