<!DOCTYPE html>
<!-- Copyright (C) 2011-2012 Frogtoss Games, Inc.  See glmike.js for license. -->
<HTML>
  <HEAD>
    <TITLE>glMikeFirst</TITLE>
    <META http-equiv="content-type" content="text-html; charset=ISO-8859-1">

    <SCRIPT type="text/javascript" src="lib/gl-Matrix.js"></SCRIPT>
    <SCRIPT type="text/javascript" src="lib/webgl-utils.js"></SCRIPT>
    <SCRIPT type="text/javascript" src="lib/ftgplane.js"></SCRIPT>
    <SCRIPt type="text/javascript" src="lib/webgl-debug.js"></SCRIPT>
    <SCRIPT src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></SCRIPT>
    <SCRIPT src="glmike.js" type="text/javascript"></SCRIPT>

    <!-- Post shading -->
    <SCRIPT id="vpost" type="x-shader/x-vertex">
                   // Common vertex post process shader -- perfect for drawTextureToViewport
                   attribute vec3 aVertexPosition;
                   attribute vec2 aTextureCoord;

                   uniform mat4 uMVMatrix;
                   uniform mat4 uPMatrix;
                   varying vec2 vTextureCoord;
                   
                   void main( void ) {
                       gl_Position = uPMatrix * uMVMatrix * vec4( aVertexPosition, 1 );
                       vTextureCoord = aTextureCoord;
                   }
    </SCRIPT>

    <SCRIPT id="fpost" type="x-shader/x-fragment">
                   precision mediump float;
                   varying vec2 vTextureCoord;
                   uniform sampler2D uSampler;

                   void main( void ) {
                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );
                       
                       gl_FragColor = col;
                   }
    </SCRIPT>


    <SCRIPT id="fpostGrayscale" type="x-shader/x-fragment">
                   precision mediump float;
                   varying vec2 vTextureCoord;
                   uniform sampler2D uSampler;
                   uniform float grayness; /* 0 to 1 */

                   void main( void ) {
                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );

                       vec3 gray = mix( col.rgb, vec3( dot( col.rgb, vec3( 0.3, 0.59, 0.11 ) ) ), grayness );
                       //vec3 gray = mix( col.rgb, vec3( dot( col.rgb, vec3( 0.3, 0.59, 0.11 ) ) ), 0.8 );
                       
                       gl_FragColor = vec4( gray, col.a );
                   }
    </SCRIPT>

    <!-- Forward shading -->
    <SCRIPT id="vdef" type="x-shader/x-vertex">
                   // A copy of the def vshader from the js source.
                   attribute vec3 aVertexPosition;
                   attribute vec2 aTextureCoord;

                   uniform mat4 uMVMatrix;
                   uniform mat4 uPMatrix;
                   uniform mat4 uBoxMatrix;

                   varying vec2 vTextureCoord;

                   void main( void ) {
                       gl_Position = uPMatrix * uMVMatrix * uBoxMatrix * vec4(aVertexPosition, 1 );
                       vTextureCoord = aTextureCoord;
                   }
    </SCRIPT>

    <SCRIPT id="fshadowstamp" type="x-shader/x-fragment">
                   precision mediump float;
                   varying vec2 vTextureCoord;
                   uniform sampler2D uSampler;

                   void main( void ) {
                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );

                       gl_FragColor = vec4( 0.0, 0.0, 0.0, col.a );
                   }
    </SCRIPT>


    <SCRIPT id="vbump" type="x-shader/x-vertex">
                   attribute vec3 aVertexPosition;
                   attribute vec3 aVertexNormal;
                   attribute vec3 aVertexTangent;
                   attribute vec2 aTextureCoord;

                   uniform mat4 uMVMatrix;
                   uniform mat4 uPMatrix;
                   uniform mat3 uNMatrix;

                   uniform mat4 uBoxMatrix;

                   uniform vec3 uLightDirection;
                   uniform vec3 uLightColor;

                   varying vec2 vTextureCoord;
                   varying vec3 vLightDir;
                   varying vec3 vEyeDir;

                   void main( void ) {
                       gl_Position = uPMatrix * uMVMatrix * uBoxMatrix * vec4(aVertexPosition, 1 );
                       vTextureCoord = aTextureCoord;

                       //vec3 n = normalize(uNMatrix * aVertexNormal);
                       //vec3 t = normalize(uNMatrix * aVertexTangent);
                       vec3 n = normalize(aVertexNormal);
                       vec3 t = normalize(aVertexTangent);
                       vec3 b = cross(n, t);

                       vec3 p = uNMatrix * normalize(uLightDirection);
                       //vec3 p = vec3(uNMatrix * normalize(uLightDirection));
                       //vec3 p = vec3(-normalize(uLightDirection));

                       vLightDir.x = dot(p, t);
                       vLightDir.y = dot(p, b);
                       vLightDir.z = dot(p, n);

                       //vEyeDir = vec3(uMVMatrix * vec4(aVertexPosition, 1));
                       vEyeDir = uNMatrix * aVertexPosition;

                       vEyeDir.x = dot(vEyeDir, t);
                       vEyeDir.y = dot(vEyeDir, b);
                       vEyeDir.z = dot(vEyeDir, n);

                   }
    </SCRIPT>

    <SCRIPT id="fbump" type="x-shader/x-fragment">
                   precision mediump float;

                   varying vec2 vTextureCoord;
                   varying vec3 vLightDir;
                   varying vec3 vEyeDir;

                   uniform vec3 uLightColor;
                   
                   uniform sampler2D uSampler;
                   uniform sampler2D uNormalSampler;

                   void main( void ) {
                       vec3 eyeDir = normalize(vEyeDir);
                       vec3 lightDir = normalize(vLightDir);

                       vec4 nCol = texture2D( uNormalSampler, vTextureCoord );
                       vec3 map = normalize(nCol.xyz * 2.0 - 1.0);

                       // diffuse
                       //float litContrib = max(dot(map, lightDir), 0.0); // "Standard Lambert"
                       float litContrib = dot(map, lightDir)*0.5 + 0.5; // "Half-Lambert"
                       vec4 litColor = vec4(litContrib * uLightColor, 1);

                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );

                       gl_FragColor = col*litColor;
                   }

                   void ex_main( void ) {
                       vec3 eyeDir = normalize(vEyeDir);
                       vec3 lightDir = normalize(vLightDir);

                       vec4 nCol = texture2D( uNormalSampler, vTextureCoord );
                       vec3 map = normalize(nCol.xyz * 2.0 - 1.0);

                       // diffuse
                       float litContrib = max(dot(map, lightDir), 0.0);
                       vec4 litColor = litContrib * vec4(uLightColor, 1);

                       //specular
                       vec3 reflectDir = reflect(lightDir, map);
                       float specContrib = max(dot(eyeDir, reflectDir), 0.0);
                       specContrib = pow(specContrib, 3.0); // hardcoded specular power!!!
                       vec4 specColor = specContrib * vec4(1,1,1,1); // hardcoded specular colour!!!

                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );

                       gl_FragColor = col*litColor + specColor;
                   }
    </SCRIPT>

    <SCRIPT id="ftoonbump" type="x-shader/x-fragment">
                   precision mediump float;

                   varying vec2 vTextureCoord;
                   varying vec3 vLightDir;
                   varying vec3 vEyeDir;

                   uniform vec3 uLightColor;
                   
                   uniform sampler2D uSampler;
                   uniform sampler2D uNormalSampler;

                   void main( void ) {
                       vec3 eyeDir = normalize(vEyeDir);
                       vec3 lightDir = normalize(vLightDir);

                       vec4 nCol = texture2D( uNormalSampler, vTextureCoord );
                       vec3 map = normalize(nCol.xyz * 2.0 - 1.0);

                       // diffuse
                       //float litContrib = max(dot(map, lightDir), 0.0); // "Standard Lambert"
                       float litContrib = dot(map, lightDir)*0.5 + 0.5; // "Half-Lambert"

                       // step shading
                       if ( litContrib < 0.2 ) litContrib = 0.2;
                       else if ( litContrib < 0.5 ) litContrib = smoothstep(0.2,0.22,litContrib)*0.3+0.2;
                       else if ( litContrib < 0.65 ) litContrib = smoothstep(0.5, 0.52, litContrib)*0.15+0.5;
                       else if ( litContrib < 0.9 ) litContrib = smoothstep(0.65, 0.67, litContrib)*0.25+0.65;
                       else litContrib = smoothstep(0.9,0.92,litContrib)*0.1+0.9;
                       //if ( litContrib < 0.2 ) litContrib = 0.2;
                       //else if ( litContrib < 0.5 ) litContrib = 0.5;
                       //else if ( litContrib < 0.65 ) litContrib = 0.65;
                       //else if ( litContrib < 0.9 ) litContrib = 0.9;
                       //else litContrib = 1.0;


                       vec4 litColor = vec4(litContrib * uLightColor, 1);


                       vec4 col = texture2D( uSampler, vec2( vTextureCoord.s, vTextureCoord.t ) );

                       gl_FragColor = col*litColor;
                   }
    </SCRIPT>

    
  </HEAD>

  <BODY onLoad="webGLStart()" style="width: 100%, height: 100%, body: 100%">

    <CANVAS id="maincanvas" style="border: none;" width="1280" height="720"></CANVAS>
    <P>Michael Labbe's plane demo</A>.
    
  </BODY>

  
</HTML>
